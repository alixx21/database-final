<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Hotel Rooms — DELUX</title>

  <link rel="stylesheet" href="./styles.css"/>

  <style>
    body{
      background:#f6f2ea;
      color:#111;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:22px 18px 120px; }

    .topbar{
      max-width:1100px; margin:0 auto;
      padding:18px 18px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:14px;
    }
    .nav{ display:flex; gap:14px; flex-wrap:wrap; align-items:center; }
    .nav a{
      text-decoration:none; color:#111;
      font-size:13px; letter-spacing:.08em; text-transform:uppercase; opacity:.75;
    }
    .nav a:hover{ opacity:1; }
    .brand img{ height:34px; width:auto; opacity:.92; }

    .hero{
      margin-top: 10px;
      border-radius: 24px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.08);
      box-shadow:0 18px 45px rgba(0,0,0,.12);
      background:#ddd;
      position:relative;
      min-height: 260px;
    }
    .hero img{ width:100%; height:360px; object-fit:cover; display:block; }
    @media (max-width: 900px){ .hero img{ height:260px; } }
    .hero::after{
      content:""; position:absolute; inset:0;
      background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,0) 55%);
      pointer-events:none;
    }
    .heroText{
      position:absolute; left:18px; right:18px; bottom:18px;
      color:#fff; z-index:2;
      display:flex; justify-content:space-between; align-items:flex-end;
      gap:10px; flex-wrap:wrap;
    }
    .heroTitle{ margin:0; font-size:36px; letter-spacing:.01em; }
    .heroMeta{ margin-top:6px; opacity:.9; font-size:14px; }
    .pill{
      display:inline-block; padding:10px 14px; border-radius:999px;
      background: rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.25);
      backdrop-filter: blur(6px);
      font-weight:600; font-size:12px;
    }

    .panel{
      margin-top: 16px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(0,0,0,.08);
      border-radius:22px;
      box-shadow:0 12px 34px rgba(0,0,0,.08);
      padding:14px;
    }
    .filters{
      display:grid;
      grid-template-columns: 1.2fr 1fr 1fr auto;
      gap:10px;
      align-items:end;
    }
    @media (max-width: 900px){ .filters{ grid-template-columns: 1fr 1fr; } }

    .field label{ display:block; font-size:12px; color:#333; opacity:.75; margin:0 0 6px 4px; }
    .field input{
      width:100%; padding:12px 12px;
      border-radius:14px; border:1px solid rgba(0,0,0,.12);
      background:#fff; outline:none; font-size:14px;
    }
    .field input:focus{
      border-color: rgba(0,0,0,.25);
      box-shadow:0 0 0 4px rgba(0,0,0,.06);
    }

    .checkRow{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; height:42px; padding:0 10px;
      border-radius:14px; border:1px solid rgba(0,0,0,.12); background:#fff;
    }
    .checkRow span{ font-size:14px; color:#111; opacity:.9; }

    .btn{
      height:44px; padding:0 16px;
      border-radius:999px; border:1px solid rgba(0,0,0,.18);
      background:#fff; font-weight:700; cursor:pointer; letter-spacing:.02em;
    }
    .btn.primary{ background:#111; color:#fff; border-color:#111; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }

    .note{
      margin-top: 10px;
      font-size: 13px;
      color:#444;
      opacity:.9;
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.75);
    }

    .grid{
      margin-top:16px;
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:14px;
    }
    @media (max-width: 1000px){ .grid{ grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 650px){ .grid{ grid-template-columns: 1fr; } }

    .card{
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      border-radius:22px;
      overflow:hidden;
      box-shadow:0 12px 30px rgba(0,0,0,.08);
      display:flex; flex-direction:column;
      min-height: 420px;
    }
    .cardImg{ height:190px; background:#eee; position:relative; }
    .cardImg img{ width:100%; height:100%; object-fit:cover; display:block; }
    .tag{
      position:absolute; left:12px; top:12px;
      padding:7px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.55);
      color:#fff; font-size:12px;
      border:1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(6px);
    }
    .cardBody{ padding:14px 14px 16px; display:flex; flex-direction:column; gap:10px; flex:1; }
    .roomTitle{ margin:0; font-size:18px; color:#111; }
    .roomDesc{ margin:0; color:#444; line-height:1.55; font-size:14px; opacity:.92; flex:1; }
    .facts{ display:flex; flex-wrap:wrap; gap:8px; }
    .fact{
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(0,0,0,.10);
      background: rgba(0,0,0,.03);
      font-size:12px; color:#222;
    }
    .cardFoot{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding:14px;
      border-top:1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.9);
    }
    .price{ font-weight:800; font-size:16px; color:#111; }
    .muted{ display:block; font-size:12px; color:#666; font-weight:500; margin-top:2px; }

    .empty{
      margin-top:16px;
      padding:18px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(0,0,0,.08);
      border-radius:18px;
      color:#333;
    }
    .error{ border-color: rgba(220,0,0,.25); }
  </style>
</head>

<body>

<header class="topbar">
  <nav class="nav">
<a class="badge nav-admin" href="./admin-hotels.html">Admin Hotels</a>
<a class="badge nav-admin" href="./admin-rooms.html">Admin Rooms</a>
<a class="badge nav-user"  href="./my-bookings.html">My bookings</a>

<a class="badge nav-guest" href="./login.html">Login</a>
<a class="badge nav-guest" href="./register.html">Register</a>

<button class="badge nav-logout" style="display:none;">Logout</button>

  </nav>

  <a class="brand" href="./index.html" aria-label="Home">
    <img src="./delux_logo_left_1920x544.png" alt="DELUX">
  </a>
</header>

<main class="wrap">

  <section class="hero" id="heroBox">
    <img id="heroImg" src="./images/hotel-1.jpg" alt="Hotel hero">
    <div class="heroText">
      <div>
        <h1 class="heroTitle" id="hotelName">Rooms</h1>
        <div class="heroMeta" id="hotelCity">Choose your room</div>
      </div>
      <div class="pill" id="hotelBadge">Hotel ID: —</div>
    </div>
  </section>

  <section class="panel">
    <div class="filters">
      <div class="field">
        <label>Min price</label>
        <input id="minPrice" type="number" placeholder="e.g. 50000">
      </div>

      <div class="field">
        <label>Max price</label>
        <input id="maxPrice" type="number" placeholder="e.g. 150000">
      </div>

      <div class="field">
        <label>Only active</label>
        <div class="checkRow">
          <span>Show available</span>
          <input id="onlyActive" type="checkbox" checked>
        </div>
      </div>

      <button class="btn primary" id="applyBtn">Apply</button>
    </div>

    <div class="note">
      <span class="badge" id="statusBadge">Ready</span>
      <button class="btn" id="resetBtn">Reset</button>
    </div>
  </section>

  <section class="grid" id="roomsGrid"></section>
  <div class="empty" id="emptyBox" style="display:none;"></div>

</main>

<script>
  const $ = (id) => document.getElementById(id);

  function getQueryParam(name){
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
  }

  function moneyKZT(n){
    const num = Number(n) || 0;
    return new Intl.NumberFormat("ru-RU").format(num) + " ₸";
  }

  // IMPORTANT: мы НЕ валидируем hotelId строго.
  // Просто если нет — покажем красивое сообщение.
  const hotelId = getQueryParam("hotelId");

  function setStatus(text, isError=false){
    const b = $("statusBadge");
    b.textContent = text;
    b.classList.toggle("error", isError);
  }

  function renderRooms(list){
    const grid = $("roomsGrid");
    const empty = $("emptyBox");
    grid.innerHTML = "";
    empty.style.display = "none";

    if (!list.length){
      empty.style.display = "block";
      empty.textContent = "No rooms found for your filters.";
      return;
    }

    const frag = document.createDocumentFragment();

    list.forEach(room => {
      const card = document.createElement("div");
      card.className = "card";

      const activeTag = room.isActive ? "Active" : "Inactive";

      card.innerHTML = `
        <div class="cardImg">
          <img src="${room.image || "./images/room-1.jpg"}" alt="${room.title}">
          <div class="tag">${activeTag}</div>
        </div>
        <div class="cardBody">
          <h3 class="roomTitle">${room.title || "Room"}</h3>
          <p class="roomDesc">${room.description || ""}</p>
          <div class="facts">
            ${(room.facts || []).slice(0,4).map(f => `<span class="fact">${f}</span>`).join("")}
          </div>
        </div>
        <div class="cardFoot">
          <div>
            <div class="price">${moneyKZT(room.pricePerNight)}</div>
            <span class="muted">per night</span>
          </div>
          <button class="btn primary" data-room="${room.id}">Book</button>
        </div>
      `;

      card.querySelector("button").addEventListener("click", () => {
        // Тут потом сделаешь реальный booking flow
        alert("Booking later: roomId=" + room.id + " | hotelId=" + hotelId);
      });

      frag.appendChild(card);
    });

    grid.appendChild(frag);
  }

  function buildRoomsUrl(){
    const min = $("minPrice").value.trim();
    const max = $("maxPrice").value.trim();
    const onlyActive = $("onlyActive").checked;

    const params = new URLSearchParams();
    if (min) params.set("minPrice", min);
    if (max) params.set("maxPrice", max);
    params.set("onlyActive", String(onlyActive));

    return `/api/hotels/${encodeURIComponent(hotelId)}/rooms?` + params.toString();
  }

  async function loadHotel(){
    const res = await fetch(`/api/hotels/${encodeURIComponent(hotelId)}`);
    if (!res.ok) throw new Error("Hotel load HTTP " + res.status);
    return await res.json();
  }

  async function loadRooms(){
    const res = await fetch(buildRoomsUrl());
    if (!res.ok) throw new Error("Rooms load HTTP " + res.status);
    const data = await res.json();
    return data.rooms || data; // на всякий, если друг вернет массив
  }

  function showSelectHotelMessage(){
    $("hotelName").textContent = "Rooms";
    $("hotelCity").textContent = "Select a hotel first";
    $("hotelBadge").textContent = "Hotel ID: —";
    $("emptyBox").style.display = "block";
    $("emptyBox").textContent =
      "No hotel selected. Open this page like: hotel.html?hotelId=YOUR_ID";
    setStatus("Missing hotelId", true);

    // блокируем кнопки чтобы не спамили запросы
    $("applyBtn").disabled = true;
  }

  async function init(){
    if (!hotelId){
      showSelectHotelMessage();
      return;
    }

    $("hotelBadge").textContent = "Hotel ID: " + hotelId;
    setStatus("Loading…");

    try{
      // 1) загрузим отель для хедера
      const h = await loadHotel();
      $("hotelName").textContent = h.name || "Hotel Rooms";
      $("hotelCity").textContent = h.city || "";
      if (h.heroImage) $("heroImg").src = h.heroImage;

      // 2) загрузим комнаты
      const rooms = await loadRooms();
      renderRooms(rooms);

      setStatus("Loaded: " + rooms.length + " rooms");
    } catch(err){
      $("emptyBox").style.display = "block";
      $("emptyBox").textContent =
        "Could not load data from server. Check backend endpoints or hotelId.";
      setStatus("Server error", true);
    }
  }

  function resetFilters(){
    $("minPrice").value = "";
    $("maxPrice").value = "";
    $("onlyActive").checked = true;
  }

  $("applyBtn").addEventListener("click", async () => {
    if (!hotelId) return;
    setStatus("Loading…");
    try{
      const rooms = await loadRooms();
      renderRooms(rooms);
      setStatus("Loaded: " + rooms.length + " rooms");
    } catch(e){
      setStatus("Server error", true);
    }
  });

  $("resetBtn").addEventListener("click", async () => {
    resetFilters();
    if (!hotelId) return;
    setStatus("Loading…");
    try{
      const rooms = await loadRooms();
      renderRooms(rooms);
      setStatus("Loaded: " + rooms.length + " rooms");
    } catch(e){
      setStatus("Server error", true);
    }
  });

  init();
</script>

</body>
</html>
